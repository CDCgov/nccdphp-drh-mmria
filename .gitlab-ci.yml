# This is a simple gitlab continuous integration example project (compatible with the shared runner provided on gitlab.com)
# using the official debian linux based dotnet docker image to build a .NET Core project.
#
# MyProject.sln
#   MyProject\
#      MyProject.csproj (console application)
#   MyProject.Test\
#      MyProject.Test.csproj (test library)
#
# Please find the full example project here:
# https://gitlab.com/tobiaskoch/gitlab-ci-example-dotnetcore

# see https://hub.docker.com/r/microsoft/dotnet/

#https://github.com/t081as/gitlab-ci-example-dotnetcore
#https://gitlab.com/jelleverheyen/dotnet-ci-example/blob/master/.gitlab-ci.yml
#https://git.cdc.gov/help/ci/quick_start/README


image: docker:17.05


stages:
    - build


variables:
    test: "Example.Test"

before_script:
    #- "cd source-code/mmria/mmria-server"
    #- "dotnet restore mmria-server.csproj"

build:
    stage: build
    script:
#        - "dotnet build  mmria-server.csproj /p:Configuration=Release /t:Clean"
#        - "curl -X POST -k https://ecpaas-dev.cdc.gov/apis/build.openshift.io/v1/namespaces/mmria/buildconfigs/mmria-s2i/webhooks/52dee2e0318578c7/generic"
        - echo "---> Version Setup - Begin ..."
        - sudo apt-get install -y curl
        - current_year=$(date +%y)
        - current_month=$(date +%m)
        - current_day=$(date +%d)
        - curl https://github.com/icuseven/MMRDS/commits/master | grep -E "commit/([0-9abcdef]{40})"  > commit_temp.txt
        - current_build=$(cat commit_temp.txt | head -n1 | cut -d "/" -f7  | awk '{print substr ($0, 0, 7)}')
        - echo "---> $current_year.$current_month.$current_day v($current_build)"
        - version_text="$current_year.$current_month.$current_day v($current_build)"
        - echo "$version_text"
        - echo "---> Version Setup - End ..."

#POST https://aidv-nccd-bdep.cdc.gov/APIFile/RunEXE HTTP/1.1
#content-type: application/json

#{
#     "WaitForResponse":  "true",
 #    "Arguments":  [
  #                     "InsertNewRecord",
#                       0,
#                       "Maternal Mortality Review Information App",
#                       "CSharp",
#                       "https://github.com/icuseven/MMRDS.git source-code/mmria",
#                       "19.08.20 v(74aac94a)",
#                       "Dev",
#                       "Haines III, James E.(CDC DDNID NCCDPHP OD) (CTR)",
#                       "http://webinspect-mmria.services-dev.cdc.gov"
#                   ],
#     "ExeFile":  "LogTFSRelease",
#     "Type":  "Standard"
#}

