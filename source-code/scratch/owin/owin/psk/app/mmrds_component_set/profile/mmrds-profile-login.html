<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<dom-module id="mmrds-profile-login">
<template>
<iron-ajax id="ajax" url="" handle-as="json" last-response="{{data}}" on-response="handle_response"></iron-ajax>
<style>
      :host {
        display: none;
      }
      :host([active]) {
        display: block;
      }
</style>
user name: <input id="name" />
password: <input id="password"/>
<input type="button" value="login" on-tap="login" />
  
  <!--paper-icon-button icon="search"></paper-icon-button-->
  
  
</template>
<script>
Polymer({
	is: 'mmrds-profile-login',
	properties: 
	{
		active: 
		{
		  type: Boolean,
		  value: true,
		  reflectToAttribute: true
		},
		bound_data: 
		{ 
			type: String,
			notify: true
		}
	},
	login: function()
	{
		//this.active = false;
		this.fire('login_changed', { is_logged_in: false });
	},
	setajax: function () 
	{
		this.$.ajax.url = "http://localhost:12345/api/session";
		this.$.ajax.params = {
				userid: this.item.street,
				password: this.item.city
		};
		this.$.ajax.generateRequest();
	},
	handle_response: function(request) 
	{
		var json_response = request.detail.response[0];
		this.item.latitude = json_response.latitude;
		this.item.longitude = json_response.longitude;
		////this.set('item.latitude',json_response.latitude);
		this.set('item.longitude',json_response.longitude);
		console.log(request.detail.response);
		
		//document.cookie = "username=John Doe; expires=Thu, 18 Dec 2013 12:00:00 UTC";
		var minutes_14 = 14;
		var current_date_time = new Date();
		var new_date_time = new Date(current_date_time.getTime() + minutes_14 * 60000);
		
		document.cookie = "auth_session=" + json_response.auth_session + "; expires=" + new_date_time.toISOString() + ";";
		
		//console.log(this.$.ajax.lastResponse);
		//{"ok":true,"userCtx":{"name":null,"roles":[]},"info":{"authentication_db":"_users","authentication_handlers":["oauth","cookie","default"]}}
		//http://stackoverflow.com/questions/34042408/polymerjs-iron-ajax-how-to-bind-token-to-headers-property
	}
});
	  
	  
</script>
	
</dom-module>