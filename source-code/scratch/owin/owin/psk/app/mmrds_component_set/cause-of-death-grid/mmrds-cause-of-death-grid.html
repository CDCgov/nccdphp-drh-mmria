<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../mmrds-state-dropdown/mmrds-state-dropdown.html">
<link rel="import" href="../mmrds-address/mmrds-address.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<dom-module id="mmrds-cause-of-death-grid">
		
	
	<template>  

	<table>
	<tr>
	<th>Type*</th>
	<th>Cause (descriptive)*</th>
	<th>ICD Code</th>
	<th>Interval</th>
	<th>Unit</th>
	</tr>
	<template id="cause_of_death_grid" is="dom-repeat" items="{{causes_of_death}}">
		<tr>
			<td>		
				<paper-dropdown-menu label="type*" selected-item-label="{{item.cause_type}}">
					<paper-listbox class="dropdown-content">
						<paper-item>Immediate</paper-item>
						<paper-item>Contributing</paper-item>
						<paper-item>Underlying</paper-item>
						<paper-item>Other significant</paper-item>
					</paper-listbox>
				</paper-dropdown-menu>	
			</td>
			<td>
				<paper-input label="Cause (descriptive)*" value="{{item.cause_description}}"></paper-input>
			</td>
			<td>
				<paper-input label="ICD code" value="{{item.icd_code}}"></paper-input>
			</td>
			<td>
				<paper-input label="Interval" value="{{item.interval}}"></paper-input>
			</td>
			<td>
				<paper-dropdown-menu label="Unit" selected-item-label="{{item.interval_unit}}">
					<paper-listbox class="dropdown-content" >
						<paper-item>Minute(s)</paper-item>
						<paper-item>Hour(s)</paper-item>
						<paper-item>Day(s)</paper-item>
						<paper-item>Week(s)</paper-item>
						<paper-item>Month(s)</paper-item>
						<paper-item>Year(s)</paper-item>
						<paper-item>Not specified</paper-item>
					</paper-listbox>
				</paper-dropdown-menu>	
			</td>
		</tr>
	</template>
		<tr>
			<td>		
				<paper-dropdown-menu label="type*">
					<paper-listbox class="dropdown-content">
						<paper-item>Immediate</paper-item>
						<paper-item>Contributing</paper-item>
						<paper-item>Underlying</paper-item>
						<paper-item>Other significant</paper-item>
					</paper-listbox>
				</paper-dropdown-menu>	
			</td>
			<td>
				<paper-input label="Cause (descriptive)*"></paper-input>
			</td>
			<td>
				<paper-input label="ICD code"></paper-input>
			</td>
			<td>
				<paper-input label="Interval"></paper-input>
			</td>
			<td>
				<paper-dropdown-menu label="Unit">
					<paper-listbox class="dropdown-content">
						<paper-item>Minute(s)</paper-item>
						<paper-item>Hour(s)</paper-item>
						<paper-item>Day(s)</paper-item>
						<paper-item>Week(s)</paper-item>
						<paper-item>Month(s)</paper-item>
						<paper-item>Year(s)</paper-item>
						<paper-item>Not specified</paper-item>
					</paper-listbox>
				</paper-dropdown-menu>	
			</td>
		</tr>  
	</table>
	<paper-button id="ancodr" raised>add new grid item</paper-button>
	
	
	</template>
	<script>
	Polymer({
        is: 'mmrds-cause-of-death-grid',
		properties: 
		{
			home_record: 
			{ 
				type: Object,
				notify: true
			},
			current_record_id: { 
				type: String,
				notify: true,
				observer: 'currentRecordChange'
			
			},
			death_certificate: 
			{ 
				type: Object,
				notify: true
			},
			causes_of_death: 
			{ 
				type: Object,
				notify: true//,
				//observer: 'causesOfDeathChange'
			},
		},
		currentRecordChange:function() 
		{
			  var found_index = -1;
			  for(var i = 0; i < g_data.length; i++)
			  {
				if(g_data[i]._id == this.current_record_id)
				{
					found_index = i;
					break;
				}
			  }
			  
			  if(found_index > -1)
			  {
				this.home_record = g_data[found_index];
			  }
			  else if(g_data.length > 0)
			  {
				this.home_record = g_data[0];
			  }
			  
			  if(this.home_record)
			  {
				if(this.home_record.death_certificate)
				{
					this.death_certificate = this.home_record.death_certificate;
					if(this.death_certificate.causes_of_death)
					{
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
					else
					{
						this.death_certificate.causes_of_death = [];
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
				}
				else
				{
					this.home_record.death_certificate = {};
					this.death_certificate = this.home_record.death_certificate;
					if(this.death_certificate.causes_of_death)
					{
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
					else
					{
						this.death_certificate.causes_of_death = [];
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
				}
				
			  }

			//console.log('currentRecordChange: ' + this.current_record_id);
			//console.log('home_record: ' + this.home_record);
		},
		addNewRecord: function()
		{
			this.causes_of_death.push({ cause_type:"", cause_description:"", icd_code:"", interval:"", interval_unit:"" });
			//this.notifyPath('causes_of_death',this.causes_of_death);
		},
		//observers: ['causesOfDeathChange(causes_of_death.*)', { cause_type:"", cause_description:"", icd_code:"", interval:"", interval_unit:"" }],
		causesOfDeathChange: function ()
		{
			/*
			var found_index = -1;
			  for(var i = 0; i < g_data.length; i++)
			  {
				if(g_data[i]._id == this.current_record_id)
				{
					found_index = i;
					break;
				}
			  }
			  
			  if(found_index > -1)
			  {
				this.home_record = g_data[found_index];
			  }
			  else if(g_data.length > 0)
			  {
				this.home_record = g_data[0];
			  }
			  
			  if(this.home_record)
			  {
				if(this.home_record.death_certificate)
				{
					this.death_certificate = this.home_record.death_certificate;
					if(this.death_certificate.causes_of_death)
					{
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
					else
					{
						this.death_certificate.causes_of_death = [];
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
				}
				else
				{
					this.home_record.death_certificate = {};
					this.death_certificate = this.home_record.death_certificate;
					if(this.death_certificate.causes_of_death)
					{
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
					else
					{
						this.death_certificate.causes_of_death = [];
						this.causes_of_death = this.death_certificate.causes_of_death;
					}
				}
				
			  }*/
			//this.notifyPath('causes_of_death',this.causes_of_death);
			
			//alert("bubba");
		},
		listeners: 
		{
			'ancodr.tap': 'addNewRecord'
		}


      });
	  
	  
	</script>
	
</dom-module>