<link rel="import" href="../../bower_components/polymer/polymer.html">	
<link rel="import" href="../../bower_components/paper-button/paper-button.html">	
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">	
<link rel="import" href="../../bower_components/paper-item/paper-item.html">	
<dom-module id="mmrds-app">
<template id="app">
	<app-location  route="{{route}}" use-hash-as-path></app-location>
	<app-route  route="{{route}}" pattern="/:category/:id" data="{{categoryData}}" tail="{{categoryTail}}"></app-route>
	<mmrds-data-summary data="{{data}}" selected_record_id="{{categoryData.id}}"></mmrds-data-summary>
	
	<app-pouchdb-document id="currentdocumentid"
			db-name="mmrds"
			doc-id="{{categoryData.id}}"
			data="{{home_record}}">
	</app-pouchdb-document>
	
	
    <paper-drawer-panel id="paperDrawerPanel">
      <!-- Drawer Scroll Header Panel -->
      <paper-scroll-header-panel drawer fixed>

        <!-- Drawer Toolbar -->
        <paper-toolbar id="drawerToolbar">
          <span class="menu-name">Menu</span>
        </paper-toolbar>
<div>route{{route}}</div>
<div>categoryTail{{categoryTail.path}}</div>
<div>categoryData{{categoryData.category}}</div>
<div>selected_record_id{{categoryData.id}}</div>

        <!-- Drawer Content -->
        <paper-menu class="app-menu" attr-for-selected="data-route" selected="{{categoryData.category}}">
          <a data-route="home" href="#/home">
            <iron-icon icon="home"></iron-icon>
            <span>Home</span>
          </a>

          
		  
          <a data-route="summary" href="#/summary">
            <iron-icon icon="mail"></iron-icon>
            <span>Summary</span>
          </a>

          <a data-route="home-record" href="#/home-record/{{categoryData.id}}">
            <iron-icon icon="mail"></iron-icon>
            <span>Home Record</span>
          </a>

		<a data-route="death-certificate" href="#/death-certificate/{{categoryData.id}}">
			<iron-icon icon="mail"></iron-icon>
			<span>Death Certificate</span>
		</a>

		<a data-route="MaternalBirthCertificate" href="#/MaternalBirthCertificate/{{categoryData.id}}">
			<iron-icon icon="mail"></iron-icon>
			<span>Maternal Birth Certificate</span>
		</a>

		<a data-route="InfantFetalBirthCertificate" href="{{baseUrl}}InfantFetalBirthCertificate">
			<iron-icon icon="mail"></iron-icon>
			<span>Infant/Fetal Birth Certificate</span>
		</a>


		<a data-route="AutopsyReport" href="{{baseUrl}}AutopsyReport">
			<iron-icon icon="mail"></iron-icon>
			<span>Autopsy Report</span>
		</a>


		<a data-route="PrenatalCare" href="{{baseUrl}}PrenatalCare">
			<iron-icon icon="mail"></iron-icon>
			<span>Prenatal Care Records</span>
		</a>


		<a data-route="ERVisits" href="{{baseUrl}}ERVisits">
			<iron-icon icon="mail"></iron-icon>
			<span>ER Visits and Hospitalizations</span>
		</a>


		<a data-route="OtherVisits" href="{{baseUrl}}OtherVisits">
			<iron-icon icon="mail"></iron-icon>
			<span>Other medical office visits</span>
		</a>


		<a data-route="SocialPsychProfile" href="{{baseUrl}}SocialPsychProfile">
			<iron-icon icon="mail"></iron-icon>
			<span>Social and psychological profile</span>
		</a>


		<a data-route="InformantInterviews" href="{{baseUrl}}InformantInterviews">
			<iron-icon icon="mail"></iron-icon>
			<span>Informant interviews</span>
		</a>


		<a data-route="CommitteeReview" href="{{baseUrl}}CommitteeReview">
			<iron-icon icon="mail"></iron-icon>
			<span>Committee review</span>
		</a>


		<a data-route="CoreSummary" href="{{baseUrl}}CoreSummary">
			<iron-icon icon="mail"></iron-icon>
			<span>Core Summary</span>
		</a>
		
		<a data-route="users" href="{{baseUrl}}users">
            <iron-icon icon="info"></iron-icon>
            <span>Users</span>
          </a>

		<a data-route="contact" href="{{baseUrl}}contact">
			<iron-icon icon="mail"></iron-icon>
			<span>Contact</span>
        </a>
		
		</paper-menu>
		<paper-button id="savecurrentrecordbutton"  onclick="SaveCurrentRecord()"raised>save current record</paper-button>
		<paper-button onclick="InitializeNewDB()" raised>InitializeNewDB</paper-button>
		
      </paper-scroll-header-panel>

      <!-- Main Area -->
      <paper-scroll-header-panel main id="headerPanelMain" condenses keep-condensed-header>
        <!-- Main Toolbar -->
        <paper-toolbar id="mainToolbar" class="tall">
          <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle></paper-icon-button>

          <span class="space"></span>

          <!-- Toolbar icons -->
          <paper-icon-button icon="refresh"></paper-icon-button>
          <paper-icon-button icon="search"></paper-icon-button>

          <!-- Application name -->
          <div class="middle middle-container">
            <div class="app-name">MMRDS</div>
          </div>

          <!-- Application sub title -->
          <div class="bottom bottom-container">
            <div class="bottom-title">Maternal Mortality Review and Data System</div>
          </div>
        </paper-toolbar>

        <!-- Main Content -->
        <div class="content">
          <iron-pages attr-for-selected="data-route" selected="[[categoryData.category]]">
            <section data-route="home" tabindex="-1">
              <paper-material elevation="1">
			  <h1 class="page-title" tabindex="-1">Welcome to MMRDS</h1>
			  <p>The Maternal Mortality Review and Data System (MMRDS) is a software tool created by CDC to collect, store, analyze and summarize information relevant to maternal deaths. The MMRDS serves 2 purposes: first to provide complete, detailed, and organized medical and social information that can be used by medical review committees to investigate individual maternal deaths; and second to provide a standardized cumulative database for future research and analysis on maternal mortality.</p>
				</paper-material>
            </section>

            <section data-route="users" tabindex="-1">
              <paper-material elevation="1">
                <h1 class="page-title" tabindex="-1">Users</h1>
                <p>This is the users section</p>
                <a href$="{{baseUrl}}users/Addy">Addy</a><br>
                <a href$="{{baseUrl}}users/Rob">Rob</a><br>
                <a href$="{{baseUrl}}users/Chuck">Chuck</a><br>
                <a href$="{{baseUrl}}users/Sam">Sam</a>
              </paper-material>
            </section>

            <section data-route="user-info" tabindex="-1">
              <paper-material elevation="-1">
                <h1 class="page-title" tabindex="-1">User: {{params.name}}</h1>
                <div>This is {{params.name}}'s section</div>
              </paper-material>
            </section>

            <section data-route="contact" tabindex="-1">
              <paper-material elevation="1">
                <h1 class="page-title" tabindex="-1">contact</h1>
                <p>This is the contact section</p>
              </paper-material>
            </section>
			
            <section data-route="summary" tabindex="-1">
              <paper-material elevation="1">
                <h1 class="page-title" tabindex="-1">summary</h1>
			  
				<mmrds-summary data="[[data]]"></mmrds-summary>
			  
			  </paper-material>
            </section>


            <section data-route="home-record" tabindex="-1">
			<h1 class="page-title" tabindex="-1">home record</h1>
				<mmrds-home_record home_record="{{home_record}}"></mmrds-home_record>
            </section>
			
			<section data-route="death-certificate" tabindex="-1">
			<h1 class="page-title" tabindex="-1">death certificate</h1>
				<mmrds-death_certificate home_record="{{home_record}}"  death_certificate="{{home_record.death_certificate}}"></mmrds-death_certificate>
            </section>

			<section data-route="MaternalBirthCertificate" tabindex="-1">
			<h1 class="page-title" tabindex="-1">maternal birth certificate</h1>
				<mmrds-maternal-birth-certificate home_record="{{home_record}}" bound_data="{{home_record.maternal_birth_certificate}}"> </mmrds-maternal-birth-certificate>
            </section>


			<section data-route="InfantFetalBirthCertificate" tabindex="-1">

            </section>


			<section data-route="AutopsyReport" tabindex="-1">

            </section>

			<section data-route="PrenatalCare" tabindex="-1">

            </section>

			<section data-route="ERVisits" tabindex="-1">

            </section>

			<section data-route="OtherVisits" tabindex="-1">

            </section>

			<section data-route="SocialPsychProfile" tabindex="-1">

            </section>

			<section data-route="InformantInterviews" tabindex="-1">

            </section>

			<section data-route="CommitteeReview" tabindex="-1">

            </section>

			<section data-route="CoreSummary" tabindex="-1">

            </section>
			
          </iron-pages>
        </div>
      </paper-scroll-header-panel>
    </paper-drawer-panel>

    <paper-toast id="toast">
      <span class="toast-hide-button" role="button" tabindex="0" onclick="app.$.toast.hide()">Ok</span>
    </paper-toast>

  </template>

	<script>
	Polymer(
	{
        is: 'mmrds-app',
		properties: 
		{ 
			
			data: 
			{
				type: Array,
				notify: true
			},
			selected_record_id:
			{
				type:String,
				notify:true,
				//value: function() { return ''; },
				observer: 'onSelectedRecordIdChanged'
			}
		},
		ready: function ()
		{
		/*
			var ctx = this;
			var db = new PouchDB('mmrds');
			g_data = [];	
			db.allDocs({ include_docs: true }).then(function (info) 
			{
				for(var i in info.rows)
				{
					g_data.push(info.rows[i].doc);
					//console.log(info.rows[i].doc._id);
					console.log(info.rows[i].doc);	
					
				}
				this.data = g_data;
			}.bind(ctx));
			*/
		},
		handle_response: function (e) 
		{
			console.log("handle_response done.");
		},
		addNewCase: function()
		{
			var new_data = [];
			
			for(var i in g_data)
			{
				new_data.push(g_data[i]);
			}
			
			var new_record_id = new Date().toISOString();
			new_data.push
			(
				{
					_id : new_record_id,
					date_created: new Date().toISOString(),
					created_by: 'jhaines',
					date_last_updated: new Date().toISOString(),
					last_updated_by: 'jhaines',
					record_id : '',
					first_name : 'New First',
					middle_name : '',
					last_name : 'New Last',
					date_of_death : '2000-01-01',
					state_of_death : '',
					state_of_last_known_residence : '',
					agency_case_id : '',
					is_valid_maternal_mortality_record : false,
					death_certificate:
					{ 
						causes_of_death:[], 
						place_of_last_residence:
						{  
							street:"123 Old US HWY 25",
							city:"Los Angeles",
							state:"California",
							zip_code:"900890255"
						} 
					}
				}
			);
			
			g_data = new_data;
			
			this.data = g_data;
			g_selected_record_id = new_record_id;
			g_selected_record_index = g_data.length -1;
		},
		onSelectedRecordIdChanged: function(e)
		{
			if(e && e.currentTarget)
			{
				console.log('onSelectedRecordIdChanged' + e.currentTarget.dataValue)
				this.selected_record_id = e.currentTarget.dataValue;
			}
		}

    });
	  
	</script>
	
</dom-module>