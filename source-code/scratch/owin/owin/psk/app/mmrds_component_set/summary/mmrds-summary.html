<link rel="import" href="../../bower_components/polymer/polymer.html">	
<link rel="import" href="../../bower_components/paper-button/paper-button.html">	
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">	
<link rel="import" href="../../bower_components/paper-item/paper-item.html">	
<dom-module id="mmrds-summary">
	<template>  
		<!-- 
		<iron-ajax id="master_record_call" url="../../../api/master_record" handle-as="json" last-response="{{data}}" on-response="handle_response" auto></iron-ajax>
		-->
		<h2>Please select a record to work with:</h2>
		<paper-menu>
		<paper-item>
			<paper-button on-tap="addNewCase">[ add new case ]</paper-button>
		</paper-item>
		<template id="summary_repeat" is="dom-repeat" items="{{data}}">
            <paper-item>
				<a data-route="master" href="{{baseUrl}}/[[item._id]]/home-record">
					<span>[ select ]</span>
				</a>&nbsp;
				{{item.last_name}}, {{item.first_name}} {{item.middle_name}} {{item.record_id}}
			</paper-item>
        </template>
		</paper-menu>
	</template>
	<script>
	Polymer(
	{
        is: 'mmrds-summary',
		properties: 
		{ 
			
			data: 
			{
				type: Array,
				notify: true
			}
		},
		ready: function ()
		{
			var ctx = this;
			var db = new PouchDB('mmrds');
			g_data = [];	
			db.allDocs({ include_docs: true }).then(function (info) 
			{
				for(var i in info.rows)
				{
					g_data.push(info.rows[i].doc);
					//console.log(info.rows[i].doc._id);
					console.log(info.rows[i].doc);	
					
				}
				this.data = g_data;
			}.bind(ctx));
		},
		handle_response: function (e) 
		{
			console.log("handle_response done.");
		},
		addNewCase: function()
		{
			var new_data = [];
			
			for(var i in g_data)
			{
				new_data.push(g_data[i]);
			}
			
			var new_record_id = new Date().toISOString();
			new_data.push
			(
				{
					_id : new_record_id,
					record_id : '',
					first_name : 'New First',
					middle_name : '',
					last_name : 'New Last',
					date_of_death : '2000-01-01',
					state_of_death : '',
					state_of_last_known_residence : '',
					agency_case_id : '',
					is_valid_maternal_mortality_record : true,
					death_certificate:
					{ 
						causes_of_death:[], 
						place_of_last_residence:
						{  
							street:"New Street",
							city:"",
							state:"",
							zip_code:""
						} 
					}
				}
			);
			
			g_data = new_data;
			
			this.data = g_data;
			g_selected_record_id = new_record_id;
		}

    });
	  
	</script>
	
</dom-module>