<html>
<head>
<meta charset="utf-8">
<meta name="description" content="The Maternal Mortality Review Information App (MMRIA) is a public health software tool created to collect, store, analyze and summarize information relevant to maternal deaths. The MMRIA serves 2 purposes: first to provide complete, detailed, and organized medical and social information that can be used by medical review committees to investigate individual maternal deaths; and second to provide a standardized cumulative database for future research and analysis on maternal mortality.">
<title>Maternal Mortality Review Information App | Public Health | MMRIA</title>

<script src="../scripts/jquery-3.1.1.min.js"></script>
<script src="../bower_components/pouchdb/dist/pouchdb.min.js"></script>

<script src="../scripts/data_access.js" type="text/javascript"></script>
<script src="../react-test/ajax.js" type="text/javascript"></script>
<script src="../react-test/meta_navigator.js" type="text/javascript"></script>
<script src="../react-test/meta_navigator.js" type="text/javascript"></script>
<script src="../scripts/editor/tree_node.js" type="text/javascript"></script>
<script src="../scripts/editor/editor.js" type="text/javascript"></script>
<script src="../scripts/profile.js" type="text/javascript"></script>
<script type="text/javascript">
$(function ()
{
  'use strict';

var host = "ws://localhost:12345/ws";
try 
{
    var socket = new WebSocket(host);

    socket.onopen = function (openEvent) 
	{
       document.getElementById("serverStatus").innerHTML = 
          'WebSocket Status:: Socket Open';
    };

	socket.onmessage = function (messageEvent) 
	{
		if (messageEvent.data instanceof Blob) 
		{
			var destinationCanvas = document.getElementById('destination');
			var destinationContext = destinationCanvas.getContext('2d');
			var image = new Image();
			image.onload = function () 
			{
			   destinationContext.clearRect(0, 0, 
				  destinationCanvas.width, destinationCanvas.height);
			   destinationContext.drawImage(image, 0, 0);
			}
			image.src = URL.createObjectURL(messageEvent.data);
		}
		else 
		{
			document.getElementById("serverResponse").innerHTML = 
			'Server Reply:: ' + messageEvent.data;
		}
	};

	socket.onerror = function (errorEvent) 
	{
		document.getElementById("serverStatus").innerHTML = 
		'WebSocket Status:: Error was reported';
	};

	socket.onclose = function (closeEvent) 
	{
		document.getElementById("serverStatus").innerHTML = 
			'WebSocket Status:: Socket Closed';
	};
}
catch (exception)
{ 
	if (window.console) console.log(exception); 
}

 function sendTextMessage() {

    if (socket.readyState != WebSocket.OPEN) return;

    var e = document.getElementById("textmessage");
    socket.send(e.value);
 }

 function sendBinaryMessage() {
    if (socket.readyState != WebSocket.OPEN) return;

    var sourceCanvas = document.getElementById('source');

    socket.send(sourceCanvas.msToBlob());
 }      
  
  var e = document.getElementById("msgText");
socket.send(e.value);
  
  
	var app = document.querySelector('#root');

	var data_access = new Data_Access("http://localhost:5984");
	
	
	console.log('Our app is ready to rock!');


	//ReactDOM.render(React.createElement(LoginComponent, {  }), app);
	var app_reference = ReactDOM.render(React.createElement(EditorComponent, {  }), app);
	var profile_content_id = document.querySelector('#profile_content_id');
	ReactDOM.render(React.createElement(ProfileComponent, { profile_login_changed:app_reference.profile_login_changed }), profile_content_id);
	//ReactDOM.render(React.createElement(TodoApp), app);
	

	
  

	window.addEventListener('profile_login_changed', function(e) 
	{
		
	});
  
	window.addEventListener('onItemChanged', function(path, value)
	{
		
	});
  
  // Sets app default base URL
  app.baseUrl = '/';
  if (window.location.port === '') {  // if production
    // Uncomment app.baseURL below and
    // set app.baseURL to '/your-pathname/' if running from folder in production
    // app.baseUrl = '/polymer-starter-kit/';
  }

});

</script>
<script type="text/javascript">

function retrieve_existing_events()
{


	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/GetExistingEventInfo",


		// the data to send (will be converted to a query string)
		data: { InstanceName: "@ViewBag.InstanceName", QuickSearchText: $("#existing_quick_search_text").val() },

		// whether this is a POST or GET request
		type: "GET",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			//alert(json);
			var optionSet = new Array();
			optionSet.push("<!--input type='text' value='' style='width:25%' /-->&nbsp;<input type='button' onclick='select_all(\"retrieved_existing_events_result_view\")' value='select all' /> | <input type='button' onclick='unselect_all(\"retrieved_existing_events_result_view\")' value='unselect all' /> | <input type='button' onclick='delete_selected_offers()' value='remove selected items' />");
			optionSet.push("<ul id='existing_event_view_list'>");
			for (var i in result)
			{
				var tag = result[i].condition_name + " " + result[i].position_number + " " + result[i].page_name + " " + result[i].headline.replace("'", "").replace("\"", "") + " " + result[i].default_image;

				optionSet.push("<li><input type='checkbox' tag='");
				optionSet.push(tag);
				optionSet.push("'  id='cb_");
				optionSet.push(result[i].block_variant_id);
				optionSet.push("'/>&nbsp;");
				optionSet.push(result[i].condition_name);
				optionSet.push("-");
				optionSet.push(result[i].position_number);
				optionSet.push("-");
				optionSet.push(result[i].page_name);
				optionSet.push("-<img src='http://AdDataWCF.gaprc.net/Images.svc/Images/");
				optionSet.push(result[i].default_image);
				optionSet.push("/40/png'/>");
				optionSet.push(result[i].headline);
				optionSet.push("-");
				if (result[i].is_web_featured)
				{
					optionSet.push("<span style='color:green'>** WEB FEATURED ** </span> ");
				}
				optionSet.push("<input type='button' onclick='delete_selected_offers(\"");
				optionSet.push(result[i].block_variant_id);
				optionSet.push("\")' value='remove' /> ");
				if (result[i].is_web_featured)
				{
					optionSet.push("<input id='cbrwf_");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("' type='button' onclick='remove_web_featured_item(\"");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("\")' value='remove only web feature' style='visibility:visible' />");

					optionSet.push("<input id='cbawf_");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("' type='button' onclick='add_web_featured(\"");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("\")' value='add web feature' style='visibility:hidden' />");
				}
				else
				{
					optionSet.push("<input id='cbrwf_");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("' type='button' onclick='remove_web_featured_item(\"");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("\")' value='remove only web feature' style='visibility:hidden' />");

					optionSet.push("<input id='cbawf_");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("' type='button' onclick='add_web_featured(\"");
					optionSet.push(result[i].block_variant_id);
					optionSet.push("\")' value='add web feature' style='visibility:visible' />");
				}
				optionSet.push("</li>");



			}
			optionSet.push("</ul>");
			optionSet.push("<!--input type='text' value='' style='width:25%' /-->&nbsp;<input type='button' onclick='select_all(\"retrieved_existing_events_result_view\")' value='select all' /> | <input type='button' onclick='unselect_all(\"retrieved_existing_events_result_view\")' value='unselect all' /> | <input type='button' onclick='delete_selected_offers()' value='remove selected items' />");
			$("#retrieved_existing_events_result_view").html(optionSet.join(""));
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};



function retrieve_matching_offers()
{

	// the data to send (will be converted to a query string)
	var InstanceNameValue = "@ViewBag.InstanceName";

	var PageNameValue = $("#matching_selected_page").val();
	if (PageNameValue == null || PageNameValue.length == 0 || PageNameValue == "select page")
	{
		alert("please specifiy a page number(s).");
		return; // invalid form data
	}

	var PositionNumberListValue = $("#matching_position_number_list").val();
	if (PositionNumberListValue.length == 0)
	{
		alert("please specifiy position number(s).");
		return; // invalid form data
	}


	var VersionListValue = get_all_selected_checkboxes("matching_version_view");
	if (VersionListValue == null || VersionListValue.length == 0)
	{
		alert("please specifiy proper version(s).");
		return; // invalid form data
	}

	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/GetMatchingEventInfo",

		data: { InstanceName: InstanceNameValue, PositionNumberList: PositionNumberListValue, PageName: PageNameValue, VersionList: VersionListValue, QuickSearchText: $("#matching_quick_search_text").val() },

		// whether this is a POST or GET request
		type: "GET",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			//alert(json);
			var optionSet = new Array();
			optionSet.push("<!--input type='text' value='' style='width:25%' /-->&nbsp;<input type='button' onclick='select_all(\"matching_offer_view\")' value='select all' /> | <input type='button' onclick='unselect_all(\"matching_offer_view\")' value='unselect all' /> | <input type='button' value='add' onclick='save_selected_offers()' value='add selected items' />");
			optionSet.push("<ul id='new_event_view_list'>");
			for (var i in result)
			{
				var tag = result[i].condition_name + " " + result[i].position_number + " " + result[i].page_name + " " + result[i].headline.replace("'", "").replace("\"", "") + " " + result[i].default_image;

				optionSet.push("<li><input type='checkbox' tag='");
				optionSet.push(tag);
				optionSet.push("'  id='cb_");
				optionSet.push(result[i].block_variant_id);
				optionSet.push("'/>&nbsp;");
				optionSet.push(result[i].condition_name);
				optionSet.push("-");
				optionSet.push(result[i].position_number);
				optionSet.push("-");
				optionSet.push(result[i].page_name);
				optionSet.push("-<img src='http://AdDataWCF.gaprc.net/Images.svc/Images/");
				optionSet.push(result[i].default_image);
				optionSet.push("/40/png'/>");
				optionSet.push(result[i].headline);
				optionSet.push("-");
				optionSet.push("<input type='button' value='add' onclick='save_selected_offers(\"");
				optionSet.push(result[i].block_variant_id);
				optionSet.push("\")'/></li>");
			}
			optionSet.push("</ul>");
			optionSet.push("<!--input type='text' value='' style='width:25%' /-->&nbsp;<input type='button' onclick='select_all(\"matching_offer_view\")' value='select all' /> | <input type='button' onclick='unselect_all(\"matching_offer_view\")' value='unselect all' /> | <input type='button' value='add' onclick='save_selected_offers()' value='add selected items' />");
			$("#matching_offer_view").html(optionSet.join(""));
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};


function quick_search_retrieve_matching_offers()
{

	// the data to send (will be converted to a query string)
	var InstanceNameValue = "@ViewBag.InstanceName";

	var QuickSearchTextValue = $("#matching_quick_search_text").val();
	if (QuickSearchTextValue = null || QuickSearchTextValue.length < 4)
	{
		alert("please specifiy quick search text");
		return; // invalid form data
	}


	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/GetQuickSearchMatchingEventInfo",

		data: { InstanceName: InstanceNameValue, QuickSearchText: $("#matching_quick_search_text").val() },

		// whether this is a POST or GET request
		type: "GET",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			//alert(json);
			var optionSet = new Array();
			optionSet.push("<!--input type='text' value='' style='width:25%' /-->&nbsp;<input type='button' onclick='select_all(\"matching_offer_view\")' value='select all' /> | <input type='button' onclick='unselect_all(\"matching_offer_view\")' value='unselect all' /> | <input type='button' onclick='save_selected_offers()' value='add selected items' />");
			optionSet.push("<ul id='new_event_view_list'>");
			for (var i in result)
			{
				var tag = result[i].condition_name + " " + result[i].position_number + " " + result[i].page_name + " " + result[i].headline.replace("'", "").replace("\"", "") + " " + result[i].default_image;

				optionSet.push("<li><input type='checkbox' tag='");
				optionSet.push(tag);
				optionSet.push("'  id='cb_");
				optionSet.push(result[i].block_variant_id);
				optionSet.push("'/>&nbsp;");
				optionSet.push(result[i].condition_name);
				optionSet.push("-");
				optionSet.push(result[i].position_number);
				optionSet.push("-");
				optionSet.push(result[i].page_name);
				optionSet.push("-<img src='http://AdDataWCF.gaprc.net/Images.svc/Images/");
				optionSet.push(result[i].default_image);
				optionSet.push("/40/png'/>");
				optionSet.push(result[i].headline);
				optionSet.push("-");
				optionSet.push("<input type='button' value='add as featured' onclick='save_selected_offers(\"");
				optionSet.push(result[i].block_variant_id);
				optionSet.push("\")'/></li>");
			}
			optionSet.push("</ul>");
			optionSet.push("<!--input type='text' value='' style='width:25%' /-->&nbsp;<input type='button' onclick='select_all(\"matching_offer_view\")' value='select all' /> | <input type='button' onclick='unselect_all(\"matching_offer_view\")' value='unselect all' /> | <input type='button' onclick='save_selected_offers()' value='add selected items' />");
			$("#matching_offer_view").html(optionSet.join(""));
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};


function save_selected_offers(pBlockVariantId)
{

	var BlockVariantIdListValue = null;
	if (pBlockVariantId != null)
	{
		BlockVariantIdListValue = pBlockVariantId;
	}
	else
	{
		BlockVariantIdListValue = get_all_selected_checkboxes("new_event_view_list");
		if (BlockVariantIdListValue == null || BlockVariantIdListValue.length == 0)
		{

			alert("please specifiy proper offer(s).");
			return; // invalid form data
		}
	}

	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/AddEventItems",

		data: { BlockVariantIdList: BlockVariantIdListValue },

		// whether this is a POST or GET request
		type: "POST",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			if (result.result == "Everything is OK")
			{
				var BlockVariantIdList = BlockVariantIdListValue.split(",");
				for (var i in BlockVariantIdList)
				{
					$("#cb_" + BlockVariantIdList[i]).parent("li").remove();
				}
			}
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};


function add_web_featured(pBlockVariantId)
{

	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/AddWebFeaturedItems",

		data: { BlockVariantIdList: pBlockVariantId },

		// whether this is a POST or GET request
		type: "POST",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			if (result.result == "Everything is OK")
			{
				$("#cbrwf_" + pBlockVariantId).css('visibility','visible');
				$("#cbawf_" + pBlockVariantId).css('visibility', 'hidden');
			}
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};

function delete_selected_offers(pBlockVariantId)
{

	var BlockVariantIdListValue = null;

	if (pBlockVariantId != null)
	{
		BlockVariantIdListValue = pBlockVariantId;
	}
	else
	{
		BlockVariantIdListValue = get_all_selected_checkboxes("existing_event_view_list");
		if (BlockVariantIdListValue == null || BlockVariantIdListValue.length == 0)
		{
			alert("please specifiy proper offer(s).");
			return; // invalid form data
		}
	}

	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/RemoveEventItems",

		data: { BlockVariantIdList: BlockVariantIdListValue },

		// whether this is a POST or GET request
		type: "POST",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			if (result.result == "Everything is OK")
			{
				var BlockVariantIdList = BlockVariantIdListValue.split(",");
				for (var i in BlockVariantIdList)
				{
					$("#cb_" + BlockVariantIdList[i]).parent("li").remove();
				}
			}
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};


function remove_web_featured_item(pBlockVariantId)
{

	$.ajax({
		// the URL for the request
		url: "/ManageFeaturedProduce/RemoveWebFeaturedItems",

		data: { BlockVariantIdList: pBlockVariantId },

		// whether this is a POST or GET request
		type: "POST",

		// the type of data we expect back
		dataType: "json",

		// code to run if the request succeeds;
		// the response is passed to the function
		success: function (json)
		{
			var result = eval(json);
			if (result.result == "Everything is OK")
			{
				$("#cbrwf_" + pBlockVariantId).css('visibility', 'hidden');
				$("#cbawf_" + pBlockVariantId).css('visibility', 'visible');

			}
		},

		// code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function (xhr, status, errorThrown)
		{
			alert("Sorry, there was a problem!");
			console.log("Error: " + errorThrown);
			console.log("Status: " + status);
			console.dir(xhr);
		},

		// code to run regardless of success or failure
		complete: function (xhr, status)
		{
			//get_section_set();
			//alert("The request is complete!");
		}
	});
};

function select_all_versions(pId)
{
	var tag = pId.replace("VersionSelectAll_", "VersionDiv_") + '';
	var x = $('#' + tag);

	var y = x.find('[type = "checkbox"]');
	y.each
		(function ()
		{
			$(this).attr('checked', true);
		}
		);
}


function unselect_all_versions(pId)
{
	var tag = pId.replace("VersionUnSelectAll_", "VersionDiv_") + '';
	var x = $('#' + tag);

	var y = x.find('[type = "checkbox"]');
	y.each
		(function ()
		{
			$(this).attr('checked', false);
		}
		);
}

function select_all(containing_div_id)
{
	var x = $('#' + containing_div_id);

	var y = x.find('[type = "checkbox"]');
	y.each
		(function ()
		{
			$(this).attr('checked', true);
		}
		);
}


function unselect_all(containing_div_id)
{
	var x = $('#' + containing_div_id);

	var y = x.find('[type = "checkbox"]');
	y.each
		(function ()
		{
			$(this).attr('checked', false);
		}
		);
}

function get_all_selected_checkboxes(containing_div_id)
{
	var result = new Array();

	var x = $('#' + containing_div_id);

	var y = x.find(':checked');
	y.each
		(function ()
		{
			var temp = $(this).attr("id").split("_");
			var id = new Array();
			for(var i = 1; i < temp.length; i++)
			{
				id.push(temp[i]);
			}
			  
			result.push(id.join('_'));
		}
		);
	return result.join(",");
}

</script>
</head>
<body>
<div id='root'>
	<img src="../images/mmria-secondary.svg" height=75 width=100 />
	<h1>App Element: MMRIA</h1>
	<div id='profile_content_id'>App Element: MMRIA</div>
	<div id='page_content_id' style='clear:"left"'>
		<div id='navigation_id' />
		<div id='form_content_id' />
	</div>
</div>


</body>
</html>