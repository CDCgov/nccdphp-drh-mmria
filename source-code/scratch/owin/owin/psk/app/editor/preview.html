<html>
<head>
<meta charset="utf-8">
<meta name="description" content="The Maternal Mortality Review Information App (MMRIA) is a public health software tool created to collect, store, analyze and summarize information relevant to maternal deaths. The MMRIA serves 2 purposes: first to provide complete, detailed, and organized medical and social information that can be used by medical review committees to investigate individual maternal deaths; and second to provide a standardized cumulative database for future research and analysis on maternal mortality.">
<title>Maternal Mortality Review Information App | Public Health | MMRIA</title>

<script src="../scripts/jquery-3.1.1.min.js"></script>
<script src="../bower_components/pouchdb/dist/pouchdb.min.js"></script>

<script src="../scripts/data_access.js" type="text/javascript"></script>
<!-- script src="../scripts/ajax.js" type="text/javascript"></script>
<script src="../react-test/meta_navigator.js" type="text/javascript"></script>
<script src="../react-test/meta_navigator.js" type="text/javascript"></script>
<script src="../scripts/editor/tree_node.js" type="text/javascript"></script>
<script src="../scripts/editor/editor.js" type="text/javascript"></script-->
<script src="../scripts/profile.js" type="text/javascript"></script>
<script type="text/javascript">
$(function ()
{
	'use strict';
	Profile_Component.checkCookieForAuthentication();
	Profile_Component.render();
  
	var change_detection_map = {};

	function yourfunction() 
	{ 
		var url =  location.protocol + '//' + location.host + "/api/current_edit";

		$.ajax({
			url: url,
			method: 'GET'
		}).done(function(response) {
		  // this will be run when the AJAX request succeeds
				
			var initial_setup = false;

			var json_response = response;
			
			for(var i = 0; i < json_response.length; i++)
			{
				var item = json_response[i];
				
				
				if(item.edit_type=="json")
				{
				
					if(!change_detection_map["json"])
					{
						change_detection_map["json"] = item;
						initial_setup = true;
					}
					else if(change_detection_map["json"].id != item.id)
					{
					
						change_detection_map["json"] = item;
						console.log('metadata item changed');
						console.log(new Date().toISOString());
						console.log(item);
					}
				}
				else if(!change_detection_map[item.metadata])
				{
					change_detection_map[item.metadata] = item;
					initial_setup = true;
				}
				else if(change_detection_map[item.metadata].id != item.id)
				{
				
					change_detection_map[item.metadata].id = item.id;
					console.log('javascript item changed');
					console.log(new Date().toISOString());
					console.log(item);
				}
			}

/*

[
	{"id":"","edit_type":"json","metadata":null},
	{"id":"691a8194e2dcb8d0be248381e8a51593","edit_type":"javascript","metadata":"scripts/app.js"},
	{"id":"9bfe081c511cd92b2df43f6308f9edff","edit_type":"javascript","metadata":"scripts/data_access.js"},
	{"id":"e071abda8fe61194711cfc2ab99fe104","edit_type":"javascript","metadata":"scripts/jquery-3.1.1.min.js"},
	{"id":"b5af69f54ad79831b58f541b0525fefa","edit_type":"javascript","metadata":"scripts/profile.js"},
	{"id":"1d4375d962ccde7364cef5f9855b85e8","edit_type":"javascript","metadata":"scripts/editor/editor.js"},
	{"id":"371139b07850f44fa07b6f3fb2c1378c","edit_type":"javascript","metadata":"scripts/editor/page_renderer.js"},
	{"id":"009f6d333c375e15e57bd679b368f639","edit_type":"javascript","metadata":"scripts/editor/teeview.js"},
	{"id":"51df4194c5fce9d68ad8a46554d2aab3","edit_type":"javascript","metadata":"scripts/editor/tree_node.js"}
]

*/
			if(initial_setup)
			{
				console.log('initial setup');
				console.log(new Date().toISOString());
				console.log(change_detection_map);
			}
			  
		}).fail(function(response) {
		
			window.clearInterval(interval_id);
			console.log("failed:", response);}
		);
		
		
	}
  
	var interval_id = window.setInterval(yourfunction, 10000);
  
  /*
  $.ajax({
      url: 'somepage.cgi',
      data: {foo: 'bar'}
  }).done(function() {
      // this will be run when the AJAX request succeeds
  }).fail(function() {
      // this will be run when the AJAX request fails
  }).always(function() {
      // this will be run when the AJAX request is complete, whether it fails or succeeds
  }).done(function() {
      // this will also be run when the AJAX request succeeds
  })*/;
});
</script>
</head>
<body>
<div id='root'>
	<img src="../images/mmria-secondary.svg" height=75 width=100 />
	<h1>App Element: MMRIA</h1>
	<div id='profile_content_id'>App Element: MMRIA</div>
	<div id='page_content_id' style='clear:"left"'>
		<div id='navigation_id' />
		<div id='form_content_id' />
	</div>
</div>
</body>
</html>
