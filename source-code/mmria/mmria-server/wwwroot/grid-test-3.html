<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="The Maternal Mortality Review Information App (MMRIA) is a public health software tool created to collect, store, analyze and summarize information relevant to maternal deaths. The MMRIA serves 2 purposes: first to provide complete, detailed, and organized medical and social information that can be used by medical review committees to investigate individual maternal deaths; and second to provide a standardized cumulative database for future research and analysis on maternal mortality.">
<title>Maternal Mortality Review Information App | Public Health | MMRIA</title>
<script src="./scripts/jquery-3.1.1.min.js"></script>
<script src="./scripts/jquery-ui.min.js"></script>
<script src="./scripts/editor/schema-generator.js"></script>

<script>

var g_metadata = null;

var schema = null;

function main()
{
    get_metadata();
}

function get_metadata()
{
  	$.ajax({
			url: 'http://db1.mmria.org/metadata/2016-06-12T13:49:24.759Z',
	}).done(function(response) {
            g_metadata = response;
            schema = get_initial_schema();

            for(var child in g_metadata.lookup)
			{
                var child_node = g_metadata.lookup[child];
                set_lookUp(schema.definitions, child_node);
            }
            generate_schema(g_metadata, schema.properties, "v1");
            //console.log(schema);
            $("#output2").html
                (
                    JSON.stringify(schema)
                );
            get_cs_code();
	});
}



function get_cs_code()
{
    var code_gen_request = { action:"generate", payload: schema };
    $.ajax
    ({
            url: location.protocol + '//' + location.host + '/api/version_code_gen',
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: JSON.stringify(code_gen_request),
            type: "POST",
            headers:{ Accept: 'text/plain; charset=utf-8'}
    })
    .done
    (
        function(response) 
        {
            $("#output3").value = response;
        }
    ).fail
    (
        function(xhr, ajaxOptions, thrownError) 
        {
            $("#output3").val(xhr.responseText);
        }
    );
}

  </script>


<style> </style>

</head>
<body onload="main()">
    <div id="output">
        hello
    </div>

    <textarea id="output2" cols=80 rows=20>

    </textarea>

    <p>Code</p>
    <textarea id="output3" cols=80 rows=20>

    </textarea>
</body>
</html>
