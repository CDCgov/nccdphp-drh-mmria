<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="The Maternal Mortality Review Information App (MMRIA) is a public health software tool created to collect, store, analyze and summarize information relevant to maternal deaths. The MMRIA serves 2 purposes: first to provide complete, detailed, and organized medical and social information that can be used by medical review committees to investigate individual maternal deaths; and second to provide a standardized cumulative database for future research and analysis on maternal mortality.">
<title>Maternal Mortality Review Information App | Public Health | MMRIA</title>
<script src="./scripts/jquery-3.1.1.min.js"></script>
<script src="./scripts/jquery-ui.min.js"></script>


<script>

var g_metadata = null;

function main()
{
    get_metadata();
}

var schema = {
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "mmria_case",
  "type": "object",
  "description": "Here is a case for your ...!",
  "properties": {},
  "definitions": {}
}



function get_metadata()
{
  	$.ajax({
			url: 'http://db1.mmria.org/metadata/2016-06-12T13:49:24.759Z',
	}).done(function(response) {
            g_metadata = response;
            generate_schema(g_metadata, schema);
            console.log(schema);
            $("#output2").html
                (
                    JSON.stringify(schema)
                );
	});
}


function generate_schema(p_metadata, p_schema)
{
    // do something with the current node
    //var result = [];


    switch(p_metadata.type.toLowerCase())
    {
        case "app":
            p_schema._id = {
                    "type": "string"
            }

        break;

    }


    if(p_metadata.children)
    {
        // do something with the child nodes
        for(var i = 0; i < p_metadata.children.length; i++)
        {
            let object = null;

            var child = p_metadata.children[i];
            switch(child.type.toLowerCase())
            {
                case "group":
                
                case "form":
                    
                    object = p_schema[child.name.toLowerCase()] =  {
                        "type": "object",
                        "properties": {}
                    };
                    
                    generate_schema(child, object.properties);
                    
                    break;
                case "grid":
                        object = p_schema[child.name.toLowerCase()] =  {
                        "type": "array",
                        "properties": {}
                        };
                    
                    generate_schema(child, object.properties);

                    break;
                case "number":
                    p_schema[child.name.toLowerCase()] = { "type" : "number"}
                    break;                    
                case "string":
                    p_schema[child.name.toLowerCase()] = { "type" : "string"}
                    break;
                case "date":
                    p_schema[child.name.toLowerCase()] = { "type" : "string", "format": "date-time" }
                    break;
                case "list":
                    object = p_schema[child.name.toLowerCase()] = { "type": "string", "x-enumNames": [] }
                    for(var j in child.values)
                    {
                        object["x-enumNames"].push(child.values[j].value);
                    }
                break;

            }
            //Array.prototype.push.apply(result, print(child));
            
        }
    }

/*
    result.push("name: " + p_metadata.name + "<br/>prompt: " + p_metadata.prompt + "<br/>type: " + p_metadata.type);
    

    // before visiting all the child nodes
    if(p_metadata.children)
    {
        // do something with the child nodes
        for(var i = 0; i < p_metadata.children.length; i++)
        {
            var child = p_metadata.children[i];
            Array.prototype.push.apply(result, print(child));
            
        }
    }
*/
    // after visiting all the child nodes

   //return result;
}


  </script>


<style> </style>

</head>
<body onload="main()">
    <div id="output">
        hello
    </div>

    <textarea id="output2" cols=80 rows=20>

    </textarea>
</body>
</html>
